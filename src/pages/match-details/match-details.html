<ion-header>

  <ion-navbar [color]="'primary'">
    <button ion-button
            menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>{{ match.date | date:'shortDate' }}</ion-title>
  </ion-navbar>

  <ion-toolbar no-border-top>
    <ion-segment [(ngModel)]="segment">
      <ion-segment-button value="details">
        Details
      </ion-segment-button>
      <ion-segment-button value="map"
                          (click)="initMap()">
        Replay
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div [ngSwitch]="segment">
    <ng-container *ngSwitchCase="'details'">
      <div class="item-profile"
           [ngClass]="match.map === 'Desert_Main' ? 'miramar' : 'erangel'">
      </div>
      <div class="item-detail"
           padding>
        <h2>Rank #{{ match.team.stats.rank }}</h2>
        <mat-accordion>
          <mat-expansion-panel *ngFor="let teammate of match.team.teammates; let first = first; let i = index;"
                               [expanded]="first"
                               [ngClass]="'player-panel-' + (i <= 3 ? i : 'extra')">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{ teammate.stats.name }}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-list>
              <mat-accordion *ngIf="telemetry">
                <mat-expansion-panel hideToggle="true">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <span>Kills</span>
                      <span>{{ teammate.stats.kills }}</span>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <mat-list *ngFor="let kill of telemetry.teamKills[teammate.stats.name]">
                    <mat-list-item>
                      <h3 matLine> {{ kill.damageCauserName | damageTypePipe }} </h3>
                      <h3 matLine> {{ kill.victim.name }} </h3>
                    </mat-list-item>
                  </mat-list>
                </mat-expansion-panel>
              </mat-accordion>
              <mat-accordion *ngIf="telemetry">
                <mat-expansion-panel hideToggle="true">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <span>Damage Dealt</span>
                      <span>{{ teammate.stats.damageDealt | number : '1.0-2' }}</span>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <mat-accordion>
                    <mat-expansion-panel *ngFor="let attacks of telemetry.teamAttacks[teammate.stats.name]; let first=first"
                                         [expanded]="first"
                                         hideToggle="true">
                      <mat-expansion-panel-header>
                        <mat-panel-title>
                          {{ attacks[0].damageCauserName | damageTypePipe }}
                        </mat-panel-title>
                      </mat-expansion-panel-header>
                      <mat-list *ngFor="let attack of attacks">
                        <mat-list-item>
                          <h3 matLine> {{ attack.damage | number : '1.0-2' }} </h3>
                          <h3 matLine> {{ attack.damageReason }} </h3>
                          <h3 matLine> {{ attack.victim.name }} </h3>
                        </mat-list-item>
                      </mat-list>
                    </mat-expansion-panel>
                  </mat-accordion>
                </mat-expansion-panel>
              </mat-accordion>
            </mat-list>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </ng-container>

    <ng-container *ngSwitchCase="'map'">
      <canvas id="map"
              (tap)="drawMap($event)"></canvas>
    </ng-container>
  </div>
</ion-content>
